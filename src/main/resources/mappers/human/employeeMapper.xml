<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.semi.lynk.function.human.model.dao.EmployeeMapper">

    <resultMap id="listResultMap" type="com.semi.lynk.function.human.model.dto.EmployeeDTO">
        <id property="id" column="employee_No"/>
        <result property="name" column="employee_name"/>
        <result property="picture" column="image"/>
        <association property="humanDTO" javaType="com.semi.lynk.function.human.model.dto.HumanDTO">
            <id property="id" column="employee_No"/>
            <result property="position" column="position"/>
            <result property="employeementStatus" column="employeement_status"/>
            <result property="phoneNumber" column="mobile_no"/>
            <result property="ssn" column="ssn"/>
        </association>

    </resultMap>

    <select id="employeeFullList" resultMap="listResultMap">
        select
            a.employee_no
            ,a.employee_name
            ,b.position
            ,b.employeement_status
            ,b.mobile_no
            ,b.ssn
        from
            employee a join human_resource b on (a.employee_no = b.employee_no)
    </select>

    <resultMap id="joinResultMap" type="com.semi.lynk.function.human.model.dto.EmpAndDepDTO">
        <id property="id" column="employee_no"/>
        <result property="name" column="employee_name"/>
        <result property="email" column="email"/>
        <result property="depNo" column="department_no"/>
                <association property="departmentDTO" javaType="com.semi.lynk.function.human.model.dto.DepartmentDTO">
                    <id property="depNo" column="department_no"/>
                    <result property="depName" column="department_name"/>
                </association>
                <association property="humanDTO" javaType="com.semi.lynk.function.human.model.dto.HumanDTO">
                    <id property="id" column="employee_no"/>
                    <result property="position" column="position"/>
                </association>
    </resultMap>

    <select id="joinListResult" resultMap="joinResultMap">
    select
         a.employee_no
        ,a.employee_name
        ,b.department_name
        ,c.position
        ,a.email
    from
        employee a
        left join department b on (a.department_no = b.department_no)
        left join human_resource c on (a.employee_no = c.employee_no)
    where
        c.position is null
        and
        c.nation is null
    order by
        a.employee_no
    </select>

    <!-- 인사 등록 -->
    <insert id="registMapperhum" parameterType="com.semi.lynk.function.human.model.dto.RegistHumDTO">
        insert into human_resource
        (employee_no, position , employeement_status, address, nation, mobile_no, join_date)
        values
        (#{id}, #{position}, #{employeementStatus}, #{address}, #{nation}, #{phoneNumber}, #{joinDate})
    </insert>

</mapper>