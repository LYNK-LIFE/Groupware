<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>일반 품의서</title>
</head>
<body>
<h1>일반 품의서</h1>

<div class="container">
    <!-- 문서 첨부 영역 -->
    <div class="attachment-section">
        <h3>문서 첨부</h3>
        <div class="attachment-box">
            <button id="uploadButton">+</button>
            <p>문서를 첨부하세요</p>
            <!-- 첨부된 파일 미리보기 -->
            <img id="previewImage" src="" alt="미리보기 이미지" style="display:none;">
        </div>
    </div>

    <!-- 결재선 -->
    <div class="approval-section">
        <h3>결재선</h3>
        <button id="addApprovalButton">+</button>

        <form action="/payment/addapprover" method="post" id="approvalForm">
            <label for="employeeNo">결재자 선택:</label>
            <select id="employeeNo" name="employeeNo">
                <option value="" disabled selected>결재자를 선택하세요</option>
                <th:block th:each="employee : ${employeeList}">
                    <option th:value="${employee.employeeNo}" th:text="${employee.employeeName}"/>
                </th:block>
            </select>

            <label for="approver">결재 유형:</label>
            <select id="approver" name="approver">
                <option value="0">기안</option>
                <option value="1">참조</option>
                <option value="2">결재</option>
            </select>
        </form>
    </div>

    <!-- 파일 첨부 -->
    <div class="file-attachment-section">
        <h3>파일 첨부</h3>
        <button id="addFileButton">+</button>
        <!-- 파일 선택 -->
        <input type="file" id="fileInput" style="display: none;" />
        <p id="fileName" style="display: none;">파일 이름: </p>
    </div>

    <!-- 기안하기 버튼 -->
    <div class="submit-section">
        <button id="draftButton">기안하기</button>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 문서 첨부 버튼 클릭 시 파일 업로드 처리
        const uploadButton = document.getElementById("uploadButton");
        const previewImage = document.getElementById("previewImage");

        uploadButton.addEventListener("click", function () {
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*"; // 이미지 파일만 선택 가능
            fileInput.onchange = function () {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        previewImage.src = e.target.result; // 미리보기 이미지 설정
                        previewImage.style.display = "block"; // 이미지 표시
                    };
                    reader.readAsDataURL(file);
                }
            };
            fileInput.click(); // 파일 선택 창 열기
        });

        // 결재선 추가 버튼 클릭
        const addApprovalButton = document.getElementById("addApprovalButton");
        const approvalForm = document.getElementById("approvalForm");

        addApprovalButton.addEventListener("click", function () {
            const employeeSelect = document.getElementById("employeeNo");
            const approverSelect = document.getElementById("approver");
            const employeeName = employeeSelect.options[employeeSelect.selectedIndex].text;
            const approverType = approverSelect.options[approverSelect.selectedIndex].text;

            if (employeeSelect.value && approverSelect.value) {
                const approvalSection = document.querySelector(".approval-section");
                const newApproval = document.createElement("p");
                newApproval.textContent = `결재자: ${employeeName}, 결재 유형: ${approverType}`;
                approvalSection.appendChild(newApproval);
            } else {
                alert("결재자와 결재 유형을 선택하세요.");
            }
        });

        // 파일 첨부 버튼 클릭 시 파일 선택 창 열기
        const addFileButton = document.getElementById("addFileButton");
        const fileInput = document.getElementById("fileInput");
        const fileName = document.getElementById("fileName");

        addFileButton.addEventListener("click", function () {
            fileInput.click();
        });

        fileInput.addEventListener("change", function () {
            const file = fileInput.files[0];
            if (file) {
                fileName.textContent = `파일 이름: ${file.name}`;
                fileName.style.display = "block";
            }
        });

        // 기안하기 버튼 클릭
        const draftButton = document.getElementById("draftButton");
        draftButton.addEventListener("click", function () {
            alert("기안이 제출되었습니다!");
            // 여기에서 서버로 데이터를 전송하거나 다음 단계로 이동 가능
        });
    });
</script>
</body>
</html>
